# ğŸ—ï¸ Architecture du Projet

## ğŸ“ Structure des dossiers

```
cultural-events-pipeline/
â”‚
â”œâ”€â”€ ğŸ“‚ collectors/              # Ã‰tape 1 : Collecte
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ paris_collector.py     # Collecteur Paris
â”‚   â”œâ”€â”€ lyon_collector.py      # (Optionnel) Collecteur Lyon
â”‚   â””â”€â”€ base_collector.py      # Classe de base
â”‚
â”œâ”€â”€ ğŸ“‚ storage/                 # Ã‰tape 2 : Stockage MongoDB
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ mongodb_client.py      # Connexion MongoDB
â”‚   â””â”€â”€ raw_repository.py      # Insertion dans collection RAW
â”‚
â”œâ”€â”€ ğŸ“‚ enrichment/              # Ã‰tape 3 : Enrichissement
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ geocoding.py           # Enrichissement gÃ©ocodage
â”‚   â”œâ”€â”€ categorization.py      # Enrichissement catÃ©gories
â”‚   â”œâ”€â”€ date_processor.py      # Enrichissement dates
â”‚   â””â”€â”€ enrichment_pipeline.py # Pipeline d'enrichissement
â”‚
â”œâ”€â”€ ğŸ“‚ etl/                     # Ã‰tape 4 : ETL MongoDB â†’ SQL
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ sql_schema.py          # SchÃ©ma SQL
â”‚   â”œâ”€â”€ transformer.py         # Transformation des donnÃ©es
â”‚   â””â”€â”€ loader.py              # Chargement dans PostgreSQL
â”‚
â”œâ”€â”€ ğŸ“‚ api/                     # Ã‰tape 5 : API Backend
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                # Point d'entrÃ©e FastAPI
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ events.py          # Routes /events
â”‚   â”‚   â””â”€â”€ stats.py           # Routes /stats
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ schemas.py         # Pydantic schemas
â”‚   â””â”€â”€ database.py            # Connexion PostgreSQL
â”‚
â”œâ”€â”€ ğŸ“‚ frontend/                # Ã‰tape 6 : Dashboard
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/        # Composants React
â”‚   â”‚   â”‚   â”œâ”€â”€ EventList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EventDetail.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Stats.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Filters.tsx
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ services/          # Appels API
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ ğŸ“‚ tests/                   # Ã‰tape 7 : Tests
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_collectors.py     # Tests unitaires collecte
â”‚   â”œâ”€â”€ test_enrichment.py     # Tests enrichissement
â”‚   â”œâ”€â”€ test_etl.py            # Tests ETL
â”‚   â”œâ”€â”€ test_api.py            # Tests API
â”‚   â””â”€â”€ integration/           # Tests d'intÃ©gration
â”‚       â””â”€â”€ test_full_pipeline.py
â”‚
â”œâ”€â”€ ğŸ“‚ scripts/                 # Scripts utilitaires
â”‚   â”œâ”€â”€ init_db.py             # Initialisation des BDD
â”‚   â”œâ”€â”€ run_pipeline.py        # Lancer le pipeline complet
â”‚   â””â”€â”€ reset_data.py          # RÃ©initialisation
â”‚
â”œâ”€â”€ ğŸ“‚ sql/                     # Fichiers SQL
â”‚   â”œâ”€â”€ schema.sql             # CrÃ©ation des tables
â”‚   â””â”€â”€ indexes.sql            # CrÃ©ation des index
â”‚
â”œâ”€â”€ ğŸ“„ .env.example            # Variables d'environnement
â”œâ”€â”€ ğŸ“„ .gitignore
â”œâ”€â”€ ğŸ“„ requirements.txt        # DÃ©pendances Python
â”œâ”€â”€ ğŸ“„ README.md               # Documentation principale
â””â”€â”€ ğŸ“„ docker-compose.yml      # (Optionnel) Docker
```

---

## ğŸ”„ Flux de donnÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        1. COLLECTE                              â”‚
â”‚  Internet â†’ collect_events_paris.py â†’ events_raw.json           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. STOCKAGE RAW                              â”‚
â”‚  events_raw.json â†’ MongoDB (collection: events_raw)             â”‚
â”‚  Structure: {source, fetched_at, raw_hash, payload}            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    3. ENRICHISSEMENT                            â”‚
â”‚  MongoDB RAW â†’ Enrichment Pipeline â†’ MongoDB (events_enriched) â”‚
â”‚  â€¢ GÃ©ocodage (adresse â†’ lat/lon)                               â”‚
â”‚  â€¢ CatÃ©gorisation (ML ou rÃ¨gles)                               â”‚
â”‚  â€¢ Parsing dates (saison, jour semaine)                        â”‚
â”‚  Structure: {raw_id, status, enriched_at, data}                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    4. ETL â†’ SQL                                 â”‚
â”‚  MongoDB enriched â†’ Transformer â†’ PostgreSQL                    â”‚
â”‚  Tables: events, categories, event_categories, cities          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    5. API BACKEND                               â”‚
â”‚  PostgreSQL â† FastAPI â†’ Endpoints REST                          â”‚
â”‚  GET /events, GET /events/{id}, GET /stats                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    6. DASHBOARD                                 â”‚
â”‚  React + TypeScript â†’ Fetch API â†’ Affichage                    â”‚
â”‚  Pages: Liste, DÃ©tail, Statistiques                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Bases de donnÃ©es

### MongoDB (NoSQL)
**2 collections :**

1. **events_raw** (lecture seule aprÃ¨s insertion)
   ```javascript
   {
     _id: ObjectId("..."),
     source: "paris_open_data",
     fetched_at: ISODate("2025-01-29T10:30:00Z"),
     raw_hash: "abc123...",
     payload: { /* donnÃ©es brutes */ }
   }
   ```

2. **events_enriched** (modifiable)
   ```javascript
   {
     _id: ObjectId("..."),
     raw_id: ObjectId("..."),
     status: "success", // pending, success, failed
     enriched_at: ISODate("2025-01-29T11:00:00Z"),
     data: {
       latitude: 48.8566,
       longitude: 2.3522,
       main_category: "Musique",
       season: "Hiver",
       is_free: false
     },
     error: null // ou {code, message} si failed
   }
   ```

### PostgreSQL (SQL)
**4 tables principales :**

1. **events**
   - id, name, description, city, address
   - latitude, longitude, event_date
   - organizer, price, website

2. **categories**
   - id, name (unique)

3. **event_categories**
   - event_id, category_id (liaison many-to-many)

4. **cities**
   - id, name, department, event_count

---

## ğŸ”Œ Ports utilisÃ©s

| Service    | Port  | URL                    |
|------------|-------|------------------------|
| MongoDB    | 27017 | mongodb://localhost    |
| PostgreSQL | 5432  | postgresql://localhost |
| API        | 8000  | http://localhost:8000  |
| Frontend   | 3000  | http://localhost:3000  |

---

## ğŸš€ Ordre d'exÃ©cution

### 1ï¸âƒ£ Setup initial
```bash
# Installer les dÃ©pendances
pip install -r requirements.txt

# Initialiser les bases de donnÃ©es
python scripts/init_db.py
```

### 2ï¸âƒ£ Pipeline complet
```bash
# Option A : Tout en une fois
python scripts/run_pipeline.py

# Option B : Ã‰tape par Ã©tape
python collectors/paris_collector.py    # Collecte
python storage/raw_repository.py        # Stockage RAW
python enrichment/enrichment_pipeline.py # Enrichissement
python etl/loader.py                     # ETL â†’ SQL
```

### 3ï¸âƒ£ Lancer l'API
```bash
cd api
uvicorn main:app --reload
```

### 4ï¸âƒ£ Lancer le frontend
```bash
cd frontend
npm install
npm start
```

### 5ï¸âƒ£ Tests
```bash
pytest tests/
```

---

## ğŸ“¦ Technologies dÃ©taillÃ©es

### Backend
- **Python 3.11+** : Langage principal
- **FastAPI** : Framework API moderne
- **Pydantic** : Validation de donnÃ©es
- **SQLAlchemy** : ORM pour PostgreSQL
- **PyMongo** : Client MongoDB
- **Requests** : HTTP client

### Frontend
- **React 18** : Library UI
- **TypeScript** : Typage statique
- **Tailwind CSS** : Styling
- **Recharts** : Graphiques
- **Axios** : HTTP client

### Bases de donnÃ©es
- **MongoDB 6+** : NoSQL (RAW + Enriched)
- **PostgreSQL 15+** : SQL (donnÃ©es exploitables)

### Tests
- **pytest** : Framework de tests Python
- **Jest** : Framework de tests JavaScript
- **httpx** : Tests API asynchrones

---

## ğŸ” Variables d'environnement

CrÃ©er un fichier `.env` :

```env
# MongoDB
MONGODB_URI=mongodb://localhost:27017
MONGODB_DATABASE=cultural_events

# PostgreSQL
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DATABASE=cultural_events

# API
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=True

# Geocoding API
GEOCODING_API_KEY=optional_if_needed
```

---

## ğŸ“Š MÃ©triques de succÃ¨s

### DonnÃ©es
- âœ… 300+ Ã©vÃ©nements collectÃ©s
- âœ… Taux d'enrichissement > 90%
- âœ… Aucun doublon dans SQL

### Performance
- âœ… API : rÃ©ponse < 200ms
- âœ… Pagination efficace
- âœ… Index sur colonnes critiques

### QualitÃ©
- âœ… Couverture de tests > 70%
- âœ… Pas d'erreurs critiques
- âœ… Code documentÃ©

---

## ğŸ¯ Prochaines Ã©tapes

Vous avez compris l'architecture ? 

**Je vous propose de crÃ©er maintenant :**

1. âœ… **Ã‰TAPE 1** : Scripts de collecte (FAIT)
2. â­ï¸ **Ã‰TAPE 2** : Connexion et stockage MongoDB
3. â­ï¸ **Ã‰TAPE 3** : Pipeline d'enrichissement
4. â­ï¸ **Ã‰TAPE 4** : ETL vers PostgreSQL
5. â­ï¸ **Ã‰TAPE 5** : API FastAPI
6. â­ï¸ **Ã‰TAPE 6** : Dashboard React
7. â­ï¸ **Ã‰TAPE 7** : Tests

**ÃŠtes-vous prÃªt pour l'Ã‰TAPE 2 (MongoDB) ?** ğŸš€